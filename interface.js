const{ipcRenderer:ipcRenderer}=require("electron"),electron=require("electron").remote;$(function(){window.UI=new Object({lang:{},settings:{},init:()=>{UI.helpers.lang(),UI.tools.interactive(),UI.accounts.get_list(!0),UI.events()},tools:{interactive:()=>{$("[data-toggle=tooltip]").tooltip(),$("body").on("click","button[external], a[external]",function(a){return a.preventDefault(),ipcRenderer.send("link",$(this).attr("external")),!1}),$("form#form-settings").on("submit",function(a){a.preventDefault();let t=$(this).serializeArray();return"STOP"===UI.planner.status?ipcRenderer.invoke("save_settings",t).then(a=>{"success"===a.status&&$(".javascript-status-settings").text(a.message)}):UI.helpers.alert("error",UI.lang.registry.no_saved),!1}),$("input#account-search").on("keyup",function(){var a=$(this).val(),t=UI.accounts.list.slice(0).map(a=>a.name);a.length>1?($(".javascript-listingContent-accounts tr[data-name]").addClass("d-none"),t=t.filter(t=>{t.indexOf(a)>-1&&$(`.javascript-listingContent-accounts tr[data-name="${t}"]`).removeClass("d-none")})):$(".javascript-listingContent-accounts tr[data-name]").removeClass("d-none")})}},helpers:{tpl_list:[],tpl:async(a,t)=>{let e=UI.helpers;const d=await new Promise((t,d)=>{let s=e.tpl_list.filter(t=>t.name===a);0==s.length?ipcRenderer.invoke("tpl",{tplname:a}).then(d=>{e.tpl_list.push({name:a,string:d}),t(d)}):t(s[0].string)});return await new Promise((a,e)=>{a(Twig.twig({data:d}).render(t))})},ajax:(a,t={},e=!1)=>{ipcRenderer.invoke("tpl",{tplname:a}).then(a=>{let d=Twig.twig({data:a}).render(t);$("#pageModal .modal-content").html(d),$("#pageModal").modal("show"),e&&e()})},lang:async()=>{ipcRenderer.invoke("lang").then(a=>{UI.lang=a})},settings:async()=>{ipcRenderer.invoke("settings").then(a=>{UI.settings=a})},alert:(a,t,e)=>{var d=UI.lang,e=e||!1,a=a||"error",s=t||d.bell.alert.default;"success"===a&&iziToast.success({title:d.bell.alert.success,message:s,position:"bottomCenter"}),"error"===a&&iziToast.error({title:d.bell.alert.error,message:s,position:"bottomCenter"}),e&&e()},confirm:(a,t,e)=>{var d=UI.lang,a=a||"Вопрос?",s=e||d.bell.confirm.buttons,t=t||function(a){};return iziToast.show({theme:"dark",icon:"icon-person",title:d.bell.confirm.header,message:a,position:"center",progressBarColor:"rgb(0, 255, 184)",buttons:[["<button>"+s[0]+"</button>",function(a,e){a.hide({transitionOut:"fadeOutUp",onClosing:function(a,e,d){t(!0)}},e,"buttonName")},!0],["<button>"+s[1]+"</button>",function(a,e){a.hide({transitionOut:"fadeOutUp",onClosing:function(a,e,d){t(!1)}},e,"buttonName")}]]}),!0},time:()=>Math.round((new Date).getTime()/1e3),timetoFormat:a=>{var t=new Date(1e3*a),e={d:t.getDate()<10?"0"+t.getDate():t.getDate(),m:t.getMonth()<10?"0"+t.getMonth():t.getMonth(),y:t.getFullYear(),h:t.getHours()<10?"0"+t.getHours():t.getHours(),i:t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()};return`${e.d}.${e.m}.${e.y} ${e.h}:${e.i}`},is_account_insert:async function(a=!1){return void 0!==UI.access_data.status&&"on"===UI.access_data.status&&(!1!==a?Number(a)<=Number(UI.access_data.count):Number(UI.accounts.list.length)<Number(UI.access_data.count))}},accounts:{list:[],get_list:(a=!1)=>{ipcRenderer.invoke("accounts").then(t=>{UI.accounts.list=t,a&&UI.accounts.rendered()})},run:a=>{ipcRenderer.send("pvu_run",+a)},delete:(a,t=!0)=>{UI.helpers.confirm(UI.lang.pages.accounts.js_isRemoved,function(e){e&&ipcRenderer.invoke("account_remove",a).then(a=>{UI.accounts.list=a,t&&UI.accounts.rendered()})})},rendered:()=>{UI.helpers.tpl("layouts/accounts/listing.twig",{accounts:UI.accounts.list,lang:UI.lang}).then(a=>{$(".javascript-listingContent-accounts").html(a),$("[data-toggle=tooltip]").tooltip()})},edit:async(a=0)=>{let t=UI.accounts.list.find(t=>t.id==a)||{},e=(UI.accounts.list.map(a=>a.id),t.id>0?UI.lang.pages.accounts.edited:UI.lang.pages.accounts.created);UI.helpers.ajax("layouts/accounts/forma.twig",{item_id:a,header:e,item:t,settings:UI.settings,lang:UI.lang},()=>{$("form#form-account").off("submit"),$("form#form-account").on("submit",function(a){a.preventDefault();let t=$(this).serializeArray();return console.log("data",t),ipcRenderer.invoke("account_edit",t).then(a=>{$("form#form-account .javascript-status").text(a.mess),UI.accounts.get_list(!0),$("#pageModal").modal("hide")}),!1})})}},events:()=>{ipcRenderer.on("inv_plants_0",(a,t)=>{let e=t.account_id;$(`tr[data-id="${e}"] div[data-js="inv-motherplaint"]`).text(t.data)}),ipcRenderer.on("inv_plants_1",(a,t)=>{let e=t.account_id;$(`tr[data-id="${e}"] div[data-js="inv-inv_plants_2"]`).text(t.data)}),ipcRenderer.on("inv_plants_2",(a,t)=>{let e=t.account_id;$(`tr[data-id="${e}"] div[data-js="inv-inv_plants_1"]`).text(t.data)}),ipcRenderer.on("meta_give",(a,t)=>{console.log("meta_give -> ",t);let e=t.account_id;t.data.farm_ok?$(`tr[data-id="${e}"] div[data-js="indicator-give"]`).addClass("border-success"):$(`tr[data-id="${e}"] div[data-js="indicator-give"]`).removeClass("border-success"),$(`tr[data-id="${e}"] div[data-js="give-lvl0"]`).removeClass("badge-info").removeClass("badge-secondary"),t.data.yesterdayReward?$(`tr[data-id="${e}"] div[data-js="give-lvl0"]`).addClass("bg-info"):$(`tr[data-id="${e}"] div[data-js="give-lvl0"]`).addClass("bg-secondary"),$(`tr[data-id="${e}"] span[data-js="give-m_poliv"]`).html(t.data.mypolivCount),$(`tr[data-id="${e}"] span[data-js="give-g_poliv"]`).html(t.data.totalwater),$(`tr[data-id="${e}"] span[data-js="give-lvl1"]`).removeClass("badge-dark").removeClass("badge-success").removeClass("badge-secondary"),$(`tr[data-id="${e}"] span[data-js="give-lvl1"]`).attr("data-original-title",t.data.lvl_r1_trg),"notfinish"==t.data.lvl_r1&&$(`tr[data-id="${e}"] span[data-js="give-lvl1"]`).addClass("badge-secondary"),"rewarded"==t.data.lvl_r1&&$(`tr[data-id="${e}"] span[data-js="give-lvl1"]`).addClass("badge-success"),"notfinish"==t.data.lvl_r1&&$(`tr[data-id="${e}"] span[data-js="give-lvl1"]`).addClass("badge-dark"),$(`tr[data-id="${e}"] span[data-js="give-lvl2"]`).removeClass("badge-dark").removeClass("badge-success").removeClass("badge-secondary"),$(`tr[data-id="${e}"] span[data-js="give-lvl2"]`).attr("data-original-title",t.data.lvl_r2_trg),"notfinish"==t.data.lvl_r2&&$(`tr[data-id="${e}"] span[data-js="give-lvl2"]`).addClass("badge-secondary"),"rewarded"==t.data.lvl_r2&&$(`tr[data-id="${e}"] span[data-js="give-lvl2"]`).addClass("badge-success"),"notfinish"==t.data.lvl_r2&&$(`tr[data-id="${e}"] span[data-js="give-lvl2"]`).addClass("badge-dark"),$(`tr[data-id="${e}"] span[data-js="give-lvl3"]`).removeClass("badge-dark").removeClass("badge-success").removeClass("badge-secondary"),$(`tr[data-id="${e}"] span[data-js="give-lvl3"]`).attr("data-original-title",t.data.lvl_r3_trg),"notfinish"==t.data.lvl_r3&&$(`tr[data-id="${e}"] span[data-js="give-lvl3"]`).addClass("badge-secondary"),"rewarded"==t.data.lvl_r3&&$(`tr[data-id="${e}"] span[data-js="give-lvl3"]`).addClass("badge-success"),"notfinish"==t.data.lvl_r3&&$(`tr[data-id="${e}"] span[data-js="give-lvl3"]`).addClass("badge-dark"),$(`tr[data-id="${e}"] span[data-js="give-lvl4"]`).removeClass("badge-dark").removeClass("badge-success").removeClass("badge-secondary"),$(`tr[data-id="${e}"] span[data-js="give-lvl4"]`).attr("data-original-title",t.data.lvl_r4_trg),"notfinish"==t.data.lvl_r4&&$(`tr[data-id="${e}"] span[data-js="give-lvl4"]`).addClass("badge-secondary"),"rewarded"==t.data.lvl_r4&&$(`tr[data-id="${e}"] span[data-js="give-lvl4"]`).addClass("badge-success"),"notfinish"==t.data.lvl_r4&&$(`tr[data-id="${e}"] span[data-js="give-lvl4"]`).addClass("badge-dark"),$(`tr[data-id="${e}"] span[data-js="give-lvl5"]`).removeClass("badge-dark").removeClass("badge-success").removeClass("badge-secondary"),$(`tr[data-id="${e}"] span[data-js="give-lvl5"]`).attr("data-original-title",t.data.lvl_r5_trg),"notfinish"==t.data.lvl_r5&&$(`tr[data-id="${e}"] span[data-js="give-lvl5"]`).addClass("badge-secondary"),"rewarded"==t.data.lvl_r5&&$(`tr[data-id="${e}"] span[data-js="give-lvl5"]`).addClass("badge-success"),"notfinish"==t.data.lvl_r5&&$(`tr[data-id="${e}"] span[data-js="give-lvl5"]`).addClass("badge-dark"),$(`tr[data-id="${e}"] span[data-js="give-lvl6"]`).removeClass("badge-dark").removeClass("badge-success").removeClass("badge-secondary"),$(`tr[data-id="${e}"] span[data-js="give-lvl6"]`).attr("data-original-title",t.data.lvl_r6_trg),"notfinish"==t.data.lvl_r6&&$(`tr[data-id="${e}"] span[data-js="give-lvl6"]`).addClass("badge-secondary"),"rewarded"==t.data.lvl_r6&&$(`tr[data-id="${e}"] span[data-js="give-lvl6"]`).addClass("badge-success"),"notfinish"==t.data.lvl_r6&&$(`tr[data-id="${e}"] span[data-js="give-lvl6"]`).addClass("badge-dark")}),ipcRenderer.on("meta_stats",(a,t)=>{console.log("meta_stats -> ",t);let e=t.account_id;0==t.data.harv?$(`tr[data-id="${e}"] div[data-js="indicator-harvest"]`).removeClass("bg-success"):$(`tr[data-id="${e}"] div[data-js="indicator-harvest"]`).addClass("bg-success"),console.log("----\x3e374",t.data.pvuBalance),console.log("----\x3e374",t.data.leBalance),console.log("----\x3e374",t.data.kapusted),$(`tr[data-id="${e}"] div[data-js="pvu-balance"]`).text(t.data.pvuBalance),$(`tr[data-id="${e}"] div[data-js="le-balance"]`).text(t.data.leBalance),$(`tr[data-id="${e}"] div[data-js="kapust-balance"]`).text(t.data.kapusted)}),ipcRenderer.on("meta_tools",(a,t)=>{console.log("meta_tools -> ",t);let e=t.account_id;console.log("----\x3e388",t.data.green),$(`tr[data-id="${e}"] div[data-js="tool-spot"]`).text(t.data.spot),$(`tr[data-id="${e}"] div[data-js="tool-bpot"]`).text(t.data.bpot),$(`tr[data-id="${e}"] div[data-js="tool-water"]`).text(t.data.water),$(`tr[data-id="${e}"] div[data-js="tool-scarecrow"]`).text(t.data.crow),$(`tr[data-id="${e}"] div[data-js="tool-greenhouse"]`).text(t.data.green)}),ipcRenderer.on("meta_plants",(a,t)=>{let e=t.account_id;t.data.map(a=>{!1!==a.needWater?$(`tr[data-id="${e}"] div[data-js="indicator-water"]`).addClass("bg-danger"):$(`tr[data-id="${e}"] div[data-js="indicator-water"]`).removeClass("bg-danger"),!1!==a.hasSeed?$(`tr[data-id="${e}"] div[data-js="indicator-seed"]`).addClass("bg-danger"):$(`tr[data-id="${e}"] div[data-js="indicator-seed"]`).removeClass("bg-danger"),void 0!==a.crow&&!0===a.crow?$(`tr[data-id="${e}"] div[data-js="indicator-crow"]`).addClass("bg-danger"):$(`tr[data-id="${e}"] div[data-js="indicator-crow"]`).removeClass("bg-danger")})})}}),UI.init()});